---
- hosts: controller
  gather_facts: true
  vars:
    - var : hostvars[inventory_hostname]['ansible_env'].SSH_CONNECTION.split(' ')[2]
  tasks:
   - name: Generate /etc/hosts for all of the nodes
     blockinfile:
      dest: /etc/hosts
      marker: "# {mark} ANSIBLE GENERATED HOSTS"
      block: |
          {{ hostvars[groups['controller'][1]]['ansible_eth0']['ipv4']['address'] }}
     become: True
   - debug: var
